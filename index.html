<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gi√° N√¥ng S·∫£n</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Quicksand', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 5px 0 0 0;
      background: linear-gradient(to right, #fff7e6, #ffffff);
      color: #4b2e2e;
      text-align: center;
    }

    h1, h2 {
      color: #6b4226;
      margin: 0.2rem 0;
    }

    h3 {
      margin: 2px 0 4px 0;
      padding: 0;
      font-size: 1.5rem;
      font-weight: auto;
      color: #6b4226;
    }

    .section {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      max-width: 800px;
      margin: 2px auto 10px auto;
      border-collapse: collapse;
      font-size: 16px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: center;
    }

    th {
      background-color: #f2e6d9;
      font-weight: bold;
    }

    /* Highlight province names */
    td:first-child {
      font-weight: bold;
      color: #2c3e50;
    }

    .container {
      margin-top: 0;
      padding-top: 0;
    }

    .icon {
      font-size: 50px;
      color: #3498db;
      margin-bottom: 10px;
    }

    .label {
      font-weight: auto;
      color: #2c3e50;
    }

    .time {
      font-size: 18px;
      font-weight: bold;
      display: inline-block;
      width: auto;
      height: auto;
    }

    @media screen and (max-width: 500px) {
      h1 {
        font-size: 1rem;
      }

      h2 {
        font-size: 1rem;
      }

      table {
        width: 90%;
        font-size: 14px;
      }

      th, td {
        padding: 14px;
      }

      .container {
        padding: 10px;
      }

      .time {
        font-size: 16px;
      }

      .icon {
        font-size: 36px;
      }
    }
  </style>
</head>
<body>
  <h3>üåæ C·∫≠p Nh·∫≠t Gi√° N√¥ng S·∫£n üåæ</h3>
  
  <!-- L·ªãch √¢m d∆∞∆°ng -->
  <div class="container">
    <table class="time-table">
      <tr>
        <td colspan="3">
          <span id="clock" class="time">--:--:--</span>
        </td>
      </tr>
      <tr>
        <th>Th·ª©</th>
        <th>D∆∞∆°ng l·ªãch</th>
        <th>√Çm L·ªãch</th>
      </tr>
      <tr>
        <td><span id="thu">ƒêang t·∫£i...</span></td>
        <td><span id="ngayDuong">ƒêang t·∫£i...</span></td>
        <td><span id="ngayAmLich">ƒêang t·∫£i...</span></td>
      </tr>
    </table>

    <!-- Gi√° c√† ph√™ -->
    <div class="section" id="caphe">
      <div id="giaCaPhe">ƒêang t·∫£i gi√° c√† ph√™...</div>
    </div>

    <!-- Gi√° ti√™u -->
    <div class="section" id="tieu">
      <div id="giaTieu">ƒêang t·∫£i gi√° ti√™u...</div>
    </div>
  </div>

  <script>
    // Danh s√°ch khu v·ª±c c·ªë ƒë·ªãnh cho gi√° c√† ph√™
    const khuVucCoDinh = ["ƒê·∫Øk N√¥ng", "ƒê·∫Øk L·∫Øk", "L√¢m ƒê·ªìng", "Gia Lai"];

    // L·∫•y gi√° c√† ph√™ & ti√™u
    async function loadGia() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbzk1k3wh6KS0B3yDJzZm07HTYgmkP6sGd0HzhAjN5Kh3bGlFJgRRa93aFHzdNCOP1fz/exec');
        const data = await response.json();

        // C√† ph√™
        const cp = data.caphe;
        let cpTable = `<b>Gi√° c√† ph√™ ng√†y ${cp[0].ngay}</b><br>`;
        cpTable += `
          <table>
            <tr><th>Khu v·ª±c</th><th>Gi√°</th><th>Thay ƒë·ªïi</th></tr>
        `;

        // Chu·∫©n h√≥a d·ªØ li·ªáu t·ª´ API th√†nh map ƒë·ªÉ d·ªÖ tra c·ª©u
        const giaMap = {};
        cp.forEach(item => {
          let khuVuc = item.khuVuc
            .replace("dak nong", "ƒê·∫Øk N√¥ng")
            .replace("dak lak", "ƒê·∫Øk L·∫Øk")
            .replace("lam dong", "L√¢m ƒê·ªìng")
            .replace("gia lai", "Gia Lai");
          giaMap[khuVuc] = { gia: item.gia, thayDoi: item.thayDoi };
        });

        // Hi·ªÉn th·ªã gi√° theo danh s√°ch khu v·ª±c c·ªë ƒë·ªãnh
        khuVucCoDinh.forEach(khuVuc => {
          const info = giaMap[khuVuc] || { gia: null, thayDoi: 0 };
          const gia = info.gia ? info.gia.toLocaleString('vi-VN') : 'Ch∆∞a c√≥ gi√°';
          const thayDoi = info.thayDoi > 0 ? `‚ûï ${info.thayDoi.toLocaleString('vi-VN')}` :
                          info.thayDoi < 0 ? `‚ûñ ${Math.abs(info.thayDoi).toLocaleString('vi-VN')}` : `Kh√¥ng ƒë·ªïi`;
          
          cpTable += `<tr>
            <td>${khuVuc}</td>
            <td>${gia}</td>
            <td>${thayDoi}</td>
          </tr>`;
        });

        cpTable += `</table>`;
        document.getElementById('giaCaPhe').innerHTML = cpTable;

        // Ti√™u (gi·ªØ nguy√™n logic c≈©)
        const tieu = data.tieu;
        let tieuHTML = `<b>${tieu.tieuDe.replace("h√¥m nay ", "")}</b><br><table><tr><th>Khu V·ª±c</th><th>Gi√°</th><th>Thay ƒê·ªïi</th></tr>`;
        tieu.data.forEach(item => {
          let khuVuc = item.khuVuc
            .replace("gia lai", "Gia Lai")
            .replace("ba ria - vung tau", "B√† R·ªãa - V≈©ng T√†u")
            .replace("dak lak", "ƒê·∫Øk L·∫Øk")
            .replace("binh phuoc", "B√¨nh Ph∆∞·ªõc")
            .replace("dak nong", "ƒê·∫Øk N√¥ng")
            .charAt(0).toUpperCase() + item.khuVuc.slice(1).toLowerCase();

          let change = item.thayDoi > 0 ? `‚ûï ${item.thayDoi.toLocaleString('vi-VN')}` :
                      item.thayDoi < 0 ? `‚ûñ ${Math.abs(item.thayDoi).toLocaleString('vi-VN')}` : `Kh√¥ng ƒë·ªïi`;
          tieuHTML += `<tr><td>${khuVuc}</td><td>${item.giaMua.toLocaleString('vi-VN')}</td><td>${change}</td></tr>`;
        });
        tieuHTML += `</table>`;
        document.getElementById('giaTieu').innerHTML = tieuHTML;

      } catch (error) {
        document.getElementById('giaCaPhe').innerHTML = "üö´ Kh√¥ng l·∫•y ƒë∆∞·ª£c gi√°.";
        document.getElementById('giaTieu').innerHTML = "üö´ Kh√¥ng l·∫•y ƒë∆∞·ª£c gi√°.";
        console.error('L·ªói:', error);
      }
    }

    loadGia();
    setInterval(loadGia, 300000); // C·∫≠p nh·∫≠t m·ªói 5 ph√∫t

    // C·∫≠p nh·∫≠t th·ªùi gian th·ª±c
    function updateClock() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const timeString = `${hours}:${minutes}:${seconds}`;
      document.getElementById('clock').textContent = timeString;

      const weekdays = ['Ch·ªß Nh·∫≠t', 'Th·ª© Hai', 'Th·ª© Ba', 'Th·ª© T∆∞', 'Th·ª© NƒÉm', 'Th·ª© S√°u', 'Th·ª© B·∫£y'];
      document.getElementById('thu').textContent = weekdays[now.getDay()];
    }

    setInterval(updateClock, 1000);
    updateClock();

    // G·ªçi API l·∫•y l·ªãch √¢m d∆∞∆°ng
    async function getLichAmDuong() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwmwE8vXEAr0nLBi6foKJexM6W9ZHu2qsXPhHQ763sx-lD3KawlTh4VFUzO4HO1SDk/exec');
        const data = await response.json();
        document.getElementById('ngayDuong').textContent = data.ngayDuong || 'Kh√¥ng r√µ';
        document.getElementById('ngayAmLich').textContent = data.ngayAmLich || 'Kh√¥ng r√µ';
      } catch (error) {
        document.getElementById('ngayDuong').textContent = 'L·ªói';
        document.getElementById('ngayAmLich').textContent = 'L·ªói';
        console.error('L·ªói l·∫•y l·ªãch:', error);
      }
    }

    getLichAmDuong();
  </script>
</body>
</html>
